import win.ui;
/*DSG{{*/
var winform = win.form(text="aardio form";right=1033;bottom=617)
winform.add(
button={cls="button";text="Button";left=889;top=23;right=996;bottom=94;z=1};
custom={cls="custom";text="自定义控件";left=40;top=21;right=700;bottom=589;z=2}
)
/*}}*/

import cv2
import win.dlg.message
msg = win.dlg.message(mainForm)
var guid = "AEBAC0A7-6A2D-4547-B9E5-78E0264ED5BA"
cv2.namedWindow(guid);
hwnd = cv2.cvGetWindowHandle(guid);
hParent  = win.getParent(hwnd)
win.show(hParent,false)
win.setParent(hwnd,winform.custom.hwnd)
winform.button.oncommand = function(id,event){
    winform.text = "open camera"
	camera = cv2.videoCapture(0)
	winform.text = "opened camera"
	var fps = camera.get(5/*_CV2_CAP_PROP_FPS*/)
	while(win.delay(1)){
		winform.text = tostring(time())
		var ok,m = camera.read();
		if ok{
			cv2.imshow( guid,m )
		}
		//手动释放mat,防止自动回收不及时导致内存暴涨
		m.release()
	}
}

winform.show();
win.loopMessage();
return winform;